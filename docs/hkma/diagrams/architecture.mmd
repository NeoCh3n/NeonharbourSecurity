flowchart LR
    subgraph External
        A[SIEM\nSentinel/Splunk]
        B[EDR\nDefender/CrowdStrike]
        C[IAM\nEntra/Okta]
    end
    A -->|EventBridge PutEvents| E(EventBridge Bus)
    B -->|EventBridge PutEvents| E
    C -->|EventBridge PutEvents| E
    E --> L1[Lambda Ingest]
    L1 --> SF[Step Functions\nAsiaAgenticSoc]
    SF --> L2[Lambda GatherContext]
    SF --> L3[Lambda SummarizeWithAI]
    SF --> L4[Lambda RiskDecider]
    SF --> L5[Lambda AuditTrail]
    L2 --> DDB[(DynamoDB\nInvestigations)]
    L3 --> S3[(S3\nArtifacts Bucket)]
    L5 --> Audit[(S3\nAudit Bucket)]
    SF --> KPIs[(DynamoDB\nMetrics)]
    classDef storage fill:#f7f7f7,stroke:#1f2933,stroke-width:1px
    class DDB,S3,Audit,KPIs storage
